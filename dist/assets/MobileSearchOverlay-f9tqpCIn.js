import{a as _,r as h,u as H,h as B,j as e,X as G}from"./index-BnuycFB_.js";import{u as Q,T as U,D as X,B as S,C as I,a as q,M as J}from"./useFrontendHotels-N_4MiZjj.js";import{S as p,C as K,P as V}from"./search-BTLAkR-M.js";import{M as v}from"./map-pin-DOPbNB_R.js";import{C as W,G as Z}from"./info-DtHom8SN.js";import{C as ee}from"./chevron-right-BbAb0F-g.js";const ce=({isOpen:o,onClose:m,onSearch:M,initialStep:N="destination",hideDestination:g=!1})=>{const{searchData:t,updateSearch:c}=_(),[d,r]=h.useState(g&&N==="destination"?"dates":N),[x,w]=h.useState(new Date),[f,k]=h.useState(null),[n,$]=h.useState(""),E=H(),{hotels:O}=Q(),j=U.filter(s=>s.includes(n)),u=n.trim().length>=2?O.filter(s=>s.name.includes(n)||s.nameEn&&s.nameEn.toLowerCase().includes(n.toLowerCase())).slice(0,5):[],y=X.map(s=>({...s,cities:s.cities.filter(l=>l.includes(n)||s.name.includes(n))})).filter(s=>s.cities.length>0),L=j.length>0||y.length>0||u.length>0;h.useEffect(()=>{n.trim()!==""&&k(null)},[n]);const T=s=>c({adults:s}),F=s=>c({children:s}),P=s=>c({rooms:s}),C=s=>c({destination:s});if(h.useEffect(()=>{o?document.body.style.overflow="hidden":document.body.style.overflow=""},[o]),!o)return null;const D=()=>{if(!t.destination){r("destination"),alert("يرجى اختيار الوجهة أولاً للبدء بالبحث");return}M({city:t.destination,checkIn:t.checkIn,checkOut:t.checkOut,guests:{adults:t.adults,children:t.children,rooms:t.rooms}}),m()},R=()=>w(new Date(x.getFullYear(),x.getMonth()+1,1)),Y=()=>w(new Date(x.getFullYear(),x.getMonth()-1,1)),A=s=>{const l=[],a=new Date(s.getFullYear(),s.getMonth(),1).getDay(),b=new Date(s.getFullYear(),s.getMonth()+1,0).getDate();for(let i=0;i<(a===0?6:a-1);i++)l.push(null);for(let i=1;i<=b;i++)l.push(new Date(s.getFullYear(),s.getMonth(),i));return l};return B.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[10000] lg:hidden flex flex-col pt-12",children:[e.jsx("div",{className:`absolute inset-0 bg-primary/20 backdrop-blur-sm transition-opacity duration-[400ms] ${o?"opacity-100":"opacity-0"}`,onClick:m}),e.jsxs("div",{className:`relative mt-auto bg-white rounded-t-[3.5rem] shadow-[0_-20px_80px_rgba(0,0,0,0.2)] h-[92vh] flex flex-col overflow-hidden transition-all duration-[500ms] ease-ios transform ${o?"translate-y-0 scale-100":"translate-y-full scale-[0.98]"}`,children:[e.jsx("div",{className:"w-12 h-1.5 bg-slate-200 rounded-full mx-auto my-4 shrink-0 opacity-50"}),e.jsxs("div",{className:"px-6 flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:m,className:"w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-slate-400 active:scale-90 transition-all",children:e.jsx(G,{size:20})}),e.jsx("h2",{className:"text-xl font-black text-secondary",children:"تعديل البحث"}),e.jsx("button",{onClick:D,className:"text-gold font-bold text-sm active:scale-90 transition-all",children:"تطبيق"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 no-scrollbar",children:[e.jsxs("div",{className:`grid ${g?"grid-cols-2":"grid-cols-3"} gap-2 bg-slate-50/50 p-1.5 rounded-[2rem] border border-slate-100/50 mb-8`,children:[!g&&e.jsx("button",{onClick:()=>r("destination"),className:`py-3 rounded-full text-[10px] font-black transition-all duration-300 ${d==="destination"?"bg-white shadow-sm text-gold":"text-slate-400"}`,children:"الوجهة"}),e.jsx("button",{onClick:()=>r("dates"),className:`py-3 rounded-full text-[10px] font-black transition-all duration-300 ${d==="dates"?"bg-white shadow-sm text-gold":"text-slate-400"}`,children:"التاريخ"}),e.jsx("button",{onClick:()=>r("guests"),className:`py-3 rounded-full text-[10px] font-black transition-all duration-300 ${d==="guests"?"bg-white shadow-sm text-gold":"text-slate-400"}`,children:"الضيوف"})]}),e.jsx("div",{className:`${o?"stagger-entry active":"stagger-entry"}`,children:e.jsxs("div",{className:"space-y-6",children:[d==="destination"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative sticky top-0 bg-white z-10 pb-2",children:[e.jsx("input",{type:"text",placeholder:"ابحث عن مدينة أو دولة...",value:n,onChange:s=>$(s.target.value),className:"w-full bg-slate-50 border border-slate-100 rounded-[2rem] px-6 py-5 text-sm font-black placeholder:text-slate-400 focus:outline-none focus:bg-white focus:border-gold transition-all"}),e.jsx("div",{className:"absolute left-6 top-1/2 -translate-y-1/2 text-slate-300",children:e.jsx(p,{size:22})})]}),e.jsx("div",{id:"destination-list",className:"space-y-6 pb-10",children:L?e.jsxs(e.Fragment,{children:[u.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 text-[11px] font-black text-slate-400 uppercase tracking-widest",children:[e.jsx(S,{size:14,className:"text-gold"}),"الفنادق المقترحة"]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:u.map(s=>e.jsxs("button",{onClick:()=>{m(),E(`/hotel/${s.slug}`)},className:"w-full flex items-center justify-between p-4 rounded-[2.2rem] border transition-all active:scale-[0.97] bg-white border-slate-100 text-text shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-50 overflow-hidden border border-slate-50 shrink-0",children:s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gold",children:e.jsx(S,{size:22})})}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"block font-black text-sm mb-0.5",children:s.name}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400",children:[e.jsx(v,{size:10,className:"text-gold"}),e.jsx("span",{className:"text-[10px] font-bold",children:s.city})]})]})]}),e.jsx(I,{size:18,className:"text-slate-300"})]},s.id))})]}),j.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 text-[11px] font-black text-slate-400 uppercase tracking-widest",children:[e.jsx(W,{size:14,className:"text-gold"}),"أغلب المدن حجزاً"]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:j.map(s=>e.jsxs("button",{onClick:()=>{C(s),r("dates")},className:`w-full flex items-center justify-between p-5 rounded-[2.2rem] border transition-all active:scale-[0.97] ${t.destination===s?"bg-secondary border-secondary text-white shadow-lg":"bg-white border-slate-100 text-text"}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-11 h-11 rounded-2xl flex items-center justify-center transition-all ${t.destination===s?"bg-white/20":"bg-slate-50 text-gold"}`,children:e.jsx(v,{size:22})}),e.jsx("span",{className:"font-black text-sm",children:s})]}),t.destination===s&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-white shadow-glow"})]},s))})]}),e.jsx("div",{className:"space-y-3",children:y.map(s=>{const l=f===s.code||n.trim()!==""&&!u.length;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>k(f===s.code?null:s.code),className:`w-full flex items-center justify-between p-5 rounded-3xl border transition-all active:scale-[0.98] ${f===s.code?"bg-slate-50 border-gold/20":"bg-white border-slate-100"}`,children:[e.jsx("div",{className:"text-slate-300",children:l?e.jsx(q,{size:20}):e.jsx(K,{size:20})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"font-black text-sm text-secondary",children:s.name}),e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-white shadow-sm flex items-center justify-center",children:e.jsx(Z,{size:18,className:"text-gold"})})]})]}),l&&e.jsx("div",{className:"grid grid-cols-1 gap-2 pr-4 mr-5 border-r border-slate-100 animate-premium-popup",children:s.cities.map(a=>e.jsxs("button",{onClick:()=>{C(a),r("dates")},className:`w-full flex items-center justify-between p-4 rounded-[1.8rem] border transition-all active:scale-[0.97] ${t.destination===a?"bg-secondary border-secondary text-white shadow-lg":"bg-white border-slate-50 text-text"}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-9 h-9 rounded-xl flex items-center justify-center transition-all ${t.destination===a?"bg-white/20":"bg-slate-50 text-gold"}`,children:e.jsx(v,{size:18})}),e.jsx("span",{className:"font-black text-sm",children:a})]}),t.destination===a&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white shadow-glow"})]},a))})]},s.code)})})]}):e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-6 text-slate-300",children:e.jsx(p,{size:32})}),e.jsx("p",{className:"text-sm font-black text-slate-400",children:"عذراً، لم نجد ما تبحث عنه"})]})})]}),d==="dates"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsx("button",{onClick:Y,className:"w-10 h-10 rounded-full border border-slate-100 flex items-center justify-center text-slate-400 active:scale-90 transition-all",children:e.jsx(ee,{size:20})}),e.jsx("h3",{className:"font-black text-lg text-secondary",children:x.toLocaleDateString("ar-SA",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:R,className:"w-10 h-10 rounded-full border border-slate-100 flex items-center justify-center text-slate-400 active:scale-90 transition-all",children:e.jsx(I,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[["ح","ن","ث","ر","خ","ج","س"].map(s=>e.jsx("div",{className:"text-center text-[10px] font-black text-slate-300 py-2",children:s},s)),A(x).map((s,l)=>{if(!s)return e.jsx("div",{},l);const a=t.checkIn&&s.toDateString()===t.checkIn.toDateString(),b=t.checkOut&&s.toDateString()===t.checkOut.toDateString(),i=t.checkIn&&t.checkOut&&s>t.checkIn&&s<t.checkOut,z=s<new Date(new Date().setHours(0,0,0,0));return e.jsxs("div",{className:`relative py-1 flex justify-center ${i?"bg-gold/10":""}`,children:[e.jsx("button",{onClick:()=>{z||(!t.checkIn||t.checkIn&&t.checkOut?c({checkIn:s,checkOut:null}):s>t.checkIn?(c({checkOut:s}),setTimeout(()=>r("guests"),300)):c({checkIn:s,checkOut:null}))},className:`w-10 h-10 rounded-2xl flex items-center justify-center text-sm font-black transition-all relative z-10 active:scale-90 ${a||b?"bg-gold text-white shadow-lg shadow-gold/30":i?"text-secondary font-black":z?"text-slate-100":"text-slate-700 hover:bg-slate-50"}`,children:s.getDate()}),a&&t.checkOut&&e.jsx("div",{className:"absolute right-0 inset-y-1 left-1/2 bg-gold/10 z-0"}),b&&t.checkIn&&e.jsx("div",{className:"absolute left-0 inset-y-1 right-1/2 bg-gold/10 z-0"})]},l)})]})]}),d==="guests"&&e.jsx("div",{className:"space-y-4",children:[{label:"البالغين",subLabel:"أكبر من 11 سنة",val:t.adults,set:T,min:1},{label:"الأطفال",subLabel:"تحت سن 11 سنة",val:t.children,set:F,min:0},{label:"الغرف",subLabel:"حدد عدد الغرف المطلوبة",val:t.rooms,set:P,min:1}].map(s=>e.jsxs("div",{className:"p-6 bg-slate-50/50 rounded-[2.5rem] flex items-center justify-between border border-slate-100/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s.set(s.val+1),className:"w-10 h-10 rounded-full bg-gold shadow-md text-white flex items-center justify-center active:scale-90 transition-all",children:e.jsx(V,{size:18})}),e.jsx("span",{className:"font-black text-xl text-secondary w-8 text-center",children:s.val}),e.jsx("button",{onClick:()=>s.set(Math.max(s.min,s.val-1)),className:"w-10 h-10 rounded-full bg-white shadow-sm text-slate-400 flex items-center justify-center active:scale-90 transition-all border border-slate-100",children:e.jsx(J,{size:18})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"block font-black text-secondary text-sm",children:s.label}),e.jsx("span",{className:"block text-[9px] font-bold text-slate-400 mt-0.5",children:s.subLabel})]})]},s.label))})]})}),e.jsx("div",{className:"p-6 border-t border-slate-100 shrink-0",children:e.jsxs("button",{onClick:D,className:"w-full bg-secondary text-white py-5 rounded-[2.5rem] font-black text-lg shadow-xl shadow-secondary/10 active:scale-95 transition-all flex items-center justify-center gap-3",children:[e.jsx(p,{size:22}),"تحديث النتائج"]})})]})]})]}),document.body)};export{ce as M};
