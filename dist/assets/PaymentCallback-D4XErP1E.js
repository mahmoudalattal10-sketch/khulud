import{b as R,u as z,r as i,j as e,L as u,G as A,P as $,o as E}from"./index-BnuycFB_.js";import{a as x}from"./constants-DFgKc18Q.js";import{S as j}from"./sparkles-CTPBaUPN.js";import{b as I,C as T,a as M}from"./copy-BN_yJ7ui.js";import{C as v}from"./check-BqLKQ3Qa.js";import{S as D}from"./shield-check-rBeJKJH1.js";import{M as N}from"./message-circle-6bvLcKBQ.js";const V=()=>{const m=R(),w=z(),[h,s]=i.useState("loading"),[y,a]=i.useState(""),[o,k]=i.useState(""),[_,b]=i.useState(!1),C=encodeURIComponent(`مرحباً، لدي استفسار بخصوص الحجز رقم: ${o}`);i.useEffect(()=>{(async()=>{const t=new URLSearchParams(m.search),c=t.get("cartId")||t.get("cart_id"),d=t.get("tranRef")||t.get("tran_ref");if(!c){s("failed"),a("رقم الحجز مفقود");return}k(d||`BK-${c.substring(0,8)}`);const f=typeof window<"u"&&window.location.hostname!=="localhost"?"/api":"http://localhost:3001/api";if(d)try{const l=await(await fetch(`${f}/payment/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId:c,tranRef:d})})).json();if(l.success&&l.status==="PAID"){s("success"),a("تمت عملية الدفع وتأكيد الحجز بنجاح!");return}}catch(r){console.error("Verification endpoint failed, falling back to polling",r)}let p=0;const P=10,g=async()=>{try{const l=await(await fetch(`${f}/payment/status/${c}`)).json();l.paymentStatus==="PAID"||l.status==="CONFIRMED"?(s("success"),a("تمت عملية الدفع وتأكيد الحجز بنجاح!")):l.paymentStatus==="REFUNDED"?(s("failed"),a("تم استرداد المبلغ.")):p<P?(p++,setTimeout(g,2e3)):(s("failed"),a("لم يصل تأكيد الدفع من البنك بعد. يرجى التواصل معنا."))}catch(r){console.error("Check Status Error:",r),s("failed"),a("حدث خطأ أثناء التحقق من الحالة.")}};g()})()},[m]);const S=()=>{navigator.clipboard.writeText(o),b(!0),setTimeout(()=>b(!1),2e3)};return h==="loading"?e.jsxs("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center p-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-[20%] left-[10%] w-64 h-64 bg-gold/5 rounded-full blur-3xl animate-float"}),e.jsx("div",{className:"absolute bottom-[20%] right-[10%] w-96 h-96 bg-gold/5 rounded-full blur-3xl animate-float",style:{animationDelay:"2s"}}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center max-w-sm w-full",children:[e.jsxs("div",{className:"w-24 h-24 mb-8 relative",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-slate-100 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-gold border-t-transparent rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(j,{className:"w-8 h-8 text-gold animate-pulse"})})]}),e.jsx("h2",{className:"text-2xl font-black text-text mb-2 text-center",children:"جاري التحقق من طلبك"}),e.jsx("p",{className:"text-slate-400 font-bold text-sm text-center",children:"لحظات ونوافيك بالتفاصيل..."})]})]}):e.jsxs("div",{className:"min-h-screen bg-[#fdfcfb] pt-32 pb-20 px-6 relative overflow-hidden",dir:"rtl",children:[e.jsx("div",{className:"absolute top-0 right-0 w-[500px] h-[500px] bg-gold/5 rounded-full blur-[120px] -translate-y-1/2 translate-x-1/2"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-[400px] h-[400px] bg-gold/5 rounded-full blur-[100px] translate-y-1/3 -translate-x-1/3"}),e.jsx("div",{className:"max-w-2xl mx-auto relative z-10",children:h==="success"?e.jsxs("div",{className:"animate-ios-slide space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"inline-flex relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-gold/20 rounded-full blur-2xl animate-pulse"}),e.jsx("div",{className:"relative w-28 h-28 bg-white rounded-full flex items-center justify-center shadow-[0_20px_40px_rgba(16,185,129,0.15)] border border-gold-50",children:e.jsx(I,{className:"w-14 h-14 text-gold",strokeWidth:1.5})})]}),e.jsx("h1",{className:"text-4xl md:text-5xl font-black text-text tracking-tight",children:"مبروك! حجزك مؤكد"}),e.jsx("p",{className:"text-lg text-slate-500 font-bold",children:"كل شيء جاهز لاستقبالك في رحلتك القادمة"})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-3xl rounded-[3rem] border border-white p-8 md:p-10 shadow-[0_40px_100px_-20px_rgba(0,0,0,0.08)]",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center border-b border-slate-100 pb-8 mb-8",children:[e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mb-3",children:"رقم التأكيد المرجعي"}),e.jsxs("div",{className:"flex items-center gap-4 bg-slate-50 px-8 py-5 rounded-2xl border border-slate-100 relative group overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gold/0 group-hover:bg-gold/5 transition-colors duration-500"}),e.jsx("span",{className:"text-3xl font-mono font-black text-text tracking-widest",children:o}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:S,className:"p-3 bg-white rounded-xl shadow-sm border border-slate-200 hover:scale-105 active:scale-95 transition-all text-slate-500 hover:text-gold",title:"نسخ المرجع",children:_?e.jsx(v,{size:20,className:"text-gold"}):e.jsx(T,{size:20})}),e.jsx("button",{onClick:()=>window.print(),className:"p-3 bg-white rounded-xl shadow-sm border border-slate-200 hover:scale-105 active:scale-95 transition-all text-slate-500 hover:text-gold",title:"حفظ التذكرة",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-bold hidden md:block",children:"حفظ"}),e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M6 9V2h12v7"}),e.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),e.jsx("path",{d:"M6 14h12v8H6z"})]})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-10",children:[e.jsxs("div",{className:"bg-slate-50/50 p-5 rounded-3xl border border-slate-100 flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white rounded-2xl flex items-center justify-center shadow-sm text-gold",children:e.jsx(D,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase",children:"حالة الحجز"}),e.jsx("p",{className:"text-sm font-black text-text",children:"مؤكد تماماً"})]})]}),e.jsxs("div",{className:"bg-slate-50/50 p-5 rounded-3xl border border-slate-100 flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white rounded-2xl flex items-center justify-center shadow-sm text-gold",children:e.jsx(j,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase",children:"خدمة العملاء"}),e.jsx("p",{className:"text-sm font-black text-text",children:"متاحة 24/7"})]})]})]}),e.jsxs("div",{className:"space-y-4 mb-10",children:[e.jsx("h3",{className:"font-black text-text text-lg mb-6",children:"ماذا سيحدث الآن؟"}),["ستصلك رسالة تأكيد إلكترونية تحتوي على فاتورة الحجز والتفاصيل.","سيقوم منسق الرحلات بالتواصل معك خلال ساعة لتأكيد موعد الوصول.","سنقوم بإرسال تفاصيل السائق أو موقع الفندق الدقيق عبر واتساب."].map((n,t)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gold-50 text-gold flex items-center justify-center shrink-0 mt-0.5 border border-gold-100",children:e.jsx(v,{size:14,strokeWidth:3})}),e.jsx("p",{className:"text-slate-600 text-sm font-bold leading-relaxed",children:n})]},t))]}),e.jsxs(u,{to:"/",className:"w-full bg-primary text-white font-black py-5 rounded-[2rem] flex items-center justify-center gap-3 hover:bg-gold hover:scale-[1.02] active:scale-95 transition-all shadow-[0_20px_40px_-10px_rgba(0,0,0,0.2)]",children:[e.jsx(A,{size:20}),"العودة للرئيسية"]})]}),e.jsxs("div",{className:"bg-primary rounded-[3.5rem] p-4 flex flex-col md:flex-row items-center gap-4 shadow-2xl",children:[e.jsxs("div",{className:"flex-1 px-8 py-2 text-center md:text-right",children:[e.jsx("h4",{className:"text-white font-black text-lg",children:"هل لديك أي استفسار؟"}),e.jsx("p",{className:"text-slate-400 text-xs font-bold",children:"فريقنا جاهز لمساعدتك في أي وقت"})]}),e.jsxs("div",{className:"flex gap-3 pr-2",children:[e.jsx("a",{href:`tel:${x.PHONE}`,className:"w-14 h-14 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-colors",children:e.jsx($,{size:22})}),e.jsxs("a",{href:`https://wa.me/${x.WHATSAPP}?text=${C}`,target:"_blank",rel:"noopener noreferrer",className:"px-8 py-4 bg-gold hover:bg-gold text-white rounded-full font-black text-sm flex items-center gap-2 transition-all active:scale-90",children:[e.jsx(N,{size:20}),"تحدث معنا"]})]})]})]}):e.jsxs("div",{className:"animate-ios-slide space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"inline-flex relative mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-red-500/20 rounded-full blur-2xl"}),e.jsx("div",{className:"relative w-28 h-28 bg-white rounded-full flex items-center justify-center shadow-[0_20px_40px_rgba(239,68,68,0.15)] border border-red-50",children:e.jsx(M,{className:"w-14 h-14 text-red-500",strokeWidth:1.5})})]}),e.jsx("h1",{className:"text-4xl md:text-5xl font-black text-text tracking-tight",children:"نعتذر، حدثت مشكلة"}),e.jsx("p",{className:"text-lg text-slate-500 font-bold",children:"لم تكتمل عملية الدفع.. حاول مرة أخرى أو تواصل معنا"})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-3xl rounded-[3rem] border border-white p-8 md:p-10 shadow-[0_40px_100px_-20px_rgba(0,0,0,0.08)]",children:[e.jsxs("div",{className:"bg-red-50 border border-red-100 rounded-3xl p-6 mb-10 text-center",children:[e.jsx("p",{className:"text-red-900 font-black mb-1",children:"سبب الفشل:"}),e.jsx("p",{className:"text-red-700 font-bold text-sm italic",children:y})]}),e.jsxs("div",{className:"space-y-4 mb-10",children:[e.jsx("h3",{className:"font-black text-text text-lg mb-6",children:"أهم الأسباب الشائعة:"}),["رصيد غير كافٍ في البطاقة المستخدمة.","بيانات البطاقة (الرقم أو تاريخ الانتهاء) غير صحيحة.","تم إلغاء العملية أو استغرق الرد وقتاً طويلاً.","رفض البنك المصدر للبطاقة إجراء العملية دولياً."].map((n,t)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-red-50 text-red-600 flex items-center justify-center shrink-0 mt-0.5 border border-red-100 text-[10px] font-black",children:t+1}),e.jsx("p",{className:"text-slate-600 text-sm font-bold leading-relaxed",children:n})]},t))]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("button",{onClick:()=>w(-1),className:"flex-[2] bg-primary text-white font-black py-5 rounded-[2rem] flex items-center justify-center gap-3 hover:bg-gold transition-all shadow-lg active:scale-95",children:[e.jsx(E,{size:20}),"المحاولة مرة أخرى"]}),e.jsx(u,{to:"/",className:"flex-1 bg-white border border-slate-200 text-slate-600 font-black py-5 rounded-[2rem] flex items-center justify-center gap-3 hover:bg-slate-50 transition-all active:scale-95",children:"الرئيسية"})]})]}),e.jsxs("a",{href:`https://wa.me/${x.WHATSAPP}?text=${encodeURIComponent("مرحباً، واجهت مشكلة في الدفع لأحد الفنادق وأحتاج مساعدة.")}`,target:"_blank",rel:"noopener noreferrer",className:"bg-gold hover:bg-gold text-white w-full py-5 rounded-[2.5rem] font-black flex items-center justify-center gap-3 shadow-xl transition-all hover:scale-[1.02] active:scale-95",children:[e.jsx(N,{size:24}),"تواصل فوراً لحل المشكلة"]})]})}),e.jsx("div",{className:"mt-12 text-center text-slate-400 text-[10px] font-black uppercase tracking-[0.2em]",children:"بواسطة ضيافة خلود النخبة © 2026"})]})};export{V as default};
